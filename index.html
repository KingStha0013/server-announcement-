<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kingamer Server — v.13</title>

  <style>
    :root{
      --bg: #f6f7f9;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #0b5ed7;
      --success: #198754;
      --danger: #dc3545;
      --radius: 10px;
      --maxwidth: 980px;
      --gap: 16px;
      --mono: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Dark theme */
    .dark-mode:root{
      --bg: #1f2937;
      --card: #374151;
      --text: #f9fafb;
      --muted: #d1d5db;
      --accent: #60a5fa;
      --success: #34d399;
      --danger: #f87171;
    }
    .dark-mode .ann-head{ background: #374151; }
    .dark-mode .ann-item{ border-color: rgba(249, 250, 251, 0.05); }
    .dark-mode .ann-body{ border-top-color: rgba(249, 250, 251, 0.04); color: var(--muted); }
    .dark-mode .highlight-today{ background: linear-gradient(180deg, #374151, #3f4a5b); }
    .dark-mode header{ background: #374151; box-shadow: 0 2px 6px rgba(0,0,0,0.2); border-bottom: 1px solid rgba(249, 250, 251, 0.02);}
    .dark-mode .toast{ background: rgba(255,255,255,0.95); color: #333; }
    
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:var(--mono);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    button{font-family:inherit;cursor:pointer}

    /* header */
    header{background:var(--card);padding:18px 16px;box-shadow:0 2px 6px rgba(16,24,40,0.06);border-bottom:1px solid rgba(16,24,40,0.02);position:sticky;top:0;z-index:40}
    .header-inner{max-width:var(--maxwidth);margin:0 auto;display:flex;gap:12px;align-items:center;justify-content:center;position:relative}
    .flag{width:28px;height:auto}
    h1{font-size:1.45rem;margin:0;letter-spacing:0.2px;font-weight:700}
    #settingsBtn{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:none;background:transparent;width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:1.4rem;transition:background .2s, color .2s}
    #settingsBtn:hover{background:rgba(16,24,40,0.04);color:var(--text)}

    /* action row */
    .button-row{max-width:var(--maxwidth);margin:12px auto;padding:8px 12px;display:flex;gap:8px;align-items:center;overflow-x: auto; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory;}
    .button-row::-webkit-scrollbar{display: none;}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:6px;border:none;font-weight:600;color:white;background:var(--accent);transition:transform .12s,box-shadow .12s;font-size: 0.9rem; flex-shrink: 0;}
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(11,94,215,0.12);font-weight:600}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(16,24,40,0.06);font-weight:600;font-size: 0.85rem;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(11,94,215,0.08)}
    
    /* layout */
    main.container{max-width:var(--maxwidth);margin:18px auto;padding:0 14px 48px}
    .grid{display:grid;gap:var(--gap);grid-template-columns:1fr}
    @media(min-width:980px){.grid{grid-template-columns:1fr 360px}}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06);border:1px solid rgba(16,24,40,0.03)}
    .card h2{margin:0 0 8px 0;font-size:1.05rem;color:var(--text)}
    .muted{color:var(--muted);font-size:0.92rem}
    .flex{display:flex;gap:8px;align-items:center}
    .spacer{flex:1}

    /* server card */
    .server-top{display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .server-left{display:flex;gap:12px;align-items:center}
    .status-dot{width:12px;height:12px;border-radius:50%;background:var(--danger);box-shadow:0 6px 18px rgba(220,53,69,0.06)}
    .status-dot.online{background:var(--success);box-shadow:0 8px 22px rgba(25,135,84,0.06)}
    .server-meta{font-weight:700;font-size:0.98rem}
    .server-sub{color:var(--muted);font-size:0.92rem;margin-top:4px}
    .players{font-family:var(--mono);font-weight:800;color:var(--accent);margin-top:10px;font-size:1.1rem}
    .server-actions{margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap: wrap;}
    .ghost{background:transparent;border:1px solid rgba(16,24,40,0.06);padding:8px 10px;border-radius:6px; font-size: 0.85rem;}

    /* announcements and search input styling */
    .ann-controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .search-input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(16,24,40,0.06); margin-bottom: 10px;}
    .ann-list{display:flex;flex-direction:column;gap:10px;max-height:520px;overflow:auto;padding-right:6px}
    .ann-item{border:1px solid rgba(16,24,40,0.04);border-radius:8px;overflow:hidden;background:var(--card)}
    .ann-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#f8fafc;cursor:pointer}
    .ann-title{font-weight:700}
    .ann-date{color:var(--muted);font-size:0.88rem;margin-right:12px}
    .ann-body{padding:12px 14px;border-top:1px solid rgba(16,24,40,0.03);display:none;color:#222}
    .ann-item.open .ann-body{display:block}
    .badge-new{background:var(--accent);color:white;padding:4px 8px;border-radius:999px;font-weight:700;font-size:0.78rem}
    .highlight-today{background:linear-gradient(180deg,#fff9eb,#ffffff)}
    .arrow{transition:transform .22s ease;display:inline-block;margin-left:6px}
    .ann-item.open .arrow{transform:rotate(90deg)}

    /* Image inside announcement body */
    .ann-body img {
        max-width: 100%;
        height: auto;
        margin: 8px 0;
        border-radius: 6px;
    }


    /* server photos / custom item grid */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px; 
      margin-top: 8px;
    }
    .photo-item {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      cursor: pointer;
    }
    .photo-grid img {
      width: 100%;
      height: auto;
      border-radius: 6px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-height: 80px; 
      object-fit: contain;
    }
    .photo-item:hover img {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .photo-caption {
      margin-top: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }

    /* Hide the sections by default */
    .hidden {
      display: none;
    }

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(16,24,40,0.45);z-index:100}
    .modal .modal-card{width:92%;max-width:420px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.18)}
    .modal h3{margin:0 0 8px 0}
    .modal p{color:var(--muted);margin:0}
    .modal .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:14px}
    
    /* Toast */
    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:rgba(20,20,20,0.95);color:white;padding:10px 14px;border-radius:8px;font-weight:600;box-shadow:0 10px 30px rgba(0,0,0,0.35);opacity:0;pointer-events:none;transition:opacity .18s ease,transform .18s ease;z-index:200}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:auto}

    /* Footer */
    footer{text-align:center;color:var(--muted);padding:30px 0 40px;font-size:0.95rem}

    /* Discord button */
    .discord-btn {
        background: #5865f2;
        color: white;
        font-weight: 700;
        padding: 10px 12px;
        border-radius: 6px;
        display: block;
        text-align: center;
        margin-top: 10px;
        transition: transform .2s ease;
    }
    .discord-btn:hover {
        transform: translateY(-2px);
    }
    .discord-btn svg {
        margin-right: 8px;
    }

    /* Gallery modal */
    #galleryModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      align-items: center;
      justify-content: center;
      z-index: 999;
      cursor: pointer;
    }
    #galleryImg {
      max-width: 90%;
      max-height: 90%;
      display: block;
      margin: auto;
      border-radius: 8px;
    }

    @media (max-width:520px){
      .ann-controls{flex-direction:column;align-items:stretch;gap:8px}
    }
  </style>
</head>
<body>

  <header>
    <div class="header-inner" role="banner">
      <img class="flag" src="https://flagcdn.com/w20/np.png" alt="Nepal flag">
      <h1>Kingamer Server</h1>
      <button id="settingsBtn" title="Settings" aria-label="Settings">⚙️</button>
    </div>
  </header>

  <div class="button-row" role="navigation" aria-label="Primary actions">
    <a class="btn" id="linkAternos" href="https://aternos.org" target="_blank" rel="noopener noreferrer">Aternos</a>
    <a class="btn" href="https://chunkbase.com/" target="_blank" rel="noopener noreferrer">Chunkbase</a>
    <a href="https://www.mediafire.com/file/qqmxqhnwffcvc2b/FPS_Optimizer_v1.1.mcpack/file" class="btn secondary" target="_blank" rel="noopener noreferrer">MCPack</a>
    <button id="toggleGalleryBtn" class="btn secondary">Photos</button>
    <button id="toggleCraftsBtn" class="btn secondary">Custom Armour</button>
    <button id="toggleWeaponsBtn" class="btn secondary">Custom Weapon</button>
    <button id="toggleItemsBtn" class="btn secondary">Custom Items</button>
    <a class="btn secondary" id="linkReport" href="mailto:davidstha900@gmail.com?subject=Kingamer%20Server%20Report&body=Please%20describe%20the%20issue%20or%20feedback%20here.">Report</a>
  </div>

  <main class="container" role="main">
    <div class="grid">

      <div>

        <section class="card" aria-labelledby="server-title">
          <h2 id="server-title">Server Info</h2>

          <div class="server-top">
            <div class="server-left" role="status" aria-live="polite">
              <div id="statusDot" class="status-dot" aria-hidden="true"></div>
              <div>
                <div id="serverState" class="server-meta">Checking server status…</div>
                <div id="serverDetails" class="server-sub">IP: <span id="serverAddr">Kingamer.aternos.me</span> · Port: <span id="serverPort">68586</span></div>
              </div>
            </div>

            <div class="spacer" aria-hidden="true"></div>

          </div>

          <div id="onlineContent" style="display: none;">
            <div class="players" id="playerCount">—</div>
            <div id="serverMOTD" class="server-sub" style="margin-top:8px"></div>

            <div class="server-actions" role="group" aria-label="Server actions">
              <button id="copyIP" class="btn ghost" title="Copy IP">Copy IP</button>
              <button id="joinMinecraft" class="btn ghost" title="Join in Minecraft">Join in Minecraft</button>
              <button id="openAternos" class="btn ghost" title="Open Aternos">Open Aternos</button>
            </div>
          </div>
        </section>

        <section class="card" id="announcementsSection" aria-labelledby="ann-title" style="margin-top:16px; display: none;">
          <h2 id="ann-title">Announcements</h2>

          <div class="ann-controls" style="margin-top:8px">
            <input id="annSearch" class="search-input" type="search" placeholder="Search announcements..." aria-label="Search announcements">
            <div class="spacer" aria-hidden="true"></div>
          </div>

          <div class="ann-list" id="annList" aria-live="polite">
            <div class="muted">Loading announcements…</div>
          </div>
        </section>

      </div>

      <aside>
        <div class="card" aria-labelledby="info-title">
          <h2 id="info-title">Info</h2>
          <p class="muted" style="margin-top:8px">Server info and announcements are updated on page load. Latest announcement is marked <strong>NEW</strong>. Today's announcements highlighted.</p>
        </div>
        
        <section class="card hidden" id="photos-section" aria-labelledby="photos-title" style="margin-top:16px">
          <h2 id="photos-title">Server Photos</h2>
          <p class="muted" style="margin-top:8px">A few snapshots of the server to show what it looks like! (Click to enlarge)</p>
          <div class="photo-grid">
            <img src="https://i.imgur.com/uqinXKR.jpeg" alt="Server screenshot 1">
            <img src="https://i.imgur.com/cBzTmzb.jpeg" alt="Server screenshot 2">
            <img src="https://i.imgur.com/faLRrdg.jpeg" alt="Server screenshot 3">
          </div>
        </section>

        <section class="card hidden" id="crafts-section" aria-labelledby="crafts-title" style="margin-top:16px">
          <h2 id="crafts-title">Custom Armour</h2>
          <p class="muted" style="margin-top:8px">Here are all the custom armour sets available on the server. (Click to enlarge)</p>
          
          <input id="armourSearch" class="search-input" type="search" placeholder="Search armour by name..." aria-label="Search custom armour">

          <div class="photo-grid" id="crafts-grid">
            
            <div class="photo-item" data-name="Wizards Armour">
              <img src="https://i.imgur.com/kshk9KC.png" alt="Wizards Armour">
              <div class="photo-caption">Wizards Armour</div>
            </div>
            
            <div class="photo-item" data-name="Heaven Armour">
              <img src="https://i.imgur.com/u8hVDET.png" alt="Heaven Armour">
              <div class="photo-caption">Heaven Armour</div>
            </div>

            <div class="photo-item" data-name="Winter Armour">
              <img src="https://i.imgur.com/XMlYWfE.png" alt="Winter Armour">
              <div class="photo-caption">Winter Armour</div>
            </div>

            <div class="photo-item" data-name="Toxic Armour">
              <img src="https://i.imgur.com/XGriqfV.png" alt="Toxic Armour">
              <div class="photo-caption">Toxic Armour</div>
            </div>

            <div class="photo-item" data-name="Nether Armour">
              <img src="https://i.imgur.com/MCi2Gds.png" alt="Nether Armour">
              <div class="photo-caption">Nether Armour</div>
            </div>

            <div class="photo-item" data-name="Overpower Armour">
              <img src="https://i.imgur.com/dCaapQY.png" alt="Overpower Armour">
              <div class="photo-caption">Overpower Armour</div>
            </div>

            <div class="photo-item" data-name="Assassin's Armour">
              <img src="https://i.imgur.com/i3qPAvl.png" alt="Assassin's Armour">
              <div class="photo-caption">Assassin's Armour</div>
            </div>

            <div class="photo-item" data-name="Miner Armour">
              <img src="https://i.imgur.com/7INCZGd.png" alt="Miner Armour">
              <div class="photo-caption">Miner Armour</div>
            </div>

            <div class="photo-item" data-name="Thunder God Armour">
              <img src="https://i.imgur.com/GaSzlhr.png" alt="Thunder God Armour">
              <div class="photo-caption">Thunder God Armour</div>
            </div>
            
            <div class="photo-item" data-name="End Armour">
              <img src="https://i.imgur.com/rdPP838.png" alt="End Armour">
              <div class="photo-caption">End Armour</div>
            </div>
          </div>
        </section>
        
        <section class="card hidden" id="weapons-section" aria-labelledby="weapons-title" style="margin-top:16px">
          <h2 id="weapons-title">Custom Weapon</h2>
          <p class="muted" style="margin-top:8px">Here are the custom weapons available on the server. (Click to enlarge)</p>
          
          <input id="weaponSearch" class="search-input" type="search" placeholder="Search weapon by name..." aria-label="Search custom weapon">

          <div class="photo-grid" id="weapons-grid">
            <div class="photo-item" data-name="Night Spear">
              <img src="https://i.imgur.com/ruL4lE7.png" alt="Night Spear">
              <div class="photo-caption">Night Spear</div>
            </div>

            <div class="photo-item" data-name="Double Sword">
              <img src="https://i.imgur.com/8aE1k6X.png" alt="Double Sword">
              <div class="photo-caption">Double Sword</div>
            </div>

            <div class="photo-item" data-name="Sun Axe">
              <img src="https://i.imgur.com/bsbCU3l.png" alt="Sun Axe">
              <div class="photo-caption">Sun Axe</div>
            </div>

            <div class="photo-item" data-name="Fire Sword">
              <img src="https://i.imgur.com/a7tfI83.png" alt="Fire Sword">
              <div class="photo-caption">Fire Sword</div>
            </div>

            <div class="photo-item" data-name="Fire Staff">
              <img src="https://i.imgur.com/zDA5kHa.png" alt="Fire Staff">
              <div class="photo-caption">Fire Staff</div>
            </div>
            
            <div class="photo-item" data-name="Custom craft 16">
              <img src="" alt="Custom craft 16">
              <div class="photo-caption">Custom craft 16</div>
            </div>
            <div class="photo-item" data-name="Custom craft 17">
              <img src="" alt="Custom craft 17">
              <div class="photo-caption">Custom craft 17</div>
            </div>
            <div class="photo-item" data-name="Custom craft 18">
              <img src="" alt="Custom craft 18">
              <div class="photo-caption">Custom craft 18</div>
            </div>
            <div class="photo-item" data-name="Custom craft 19">
              <img src="" alt="Custom craft 19">
              <div class="photo-caption">Custom craft 19</div>
            </div>
            <div class="photo-item" data-name="Custom craft 20">
              <img src="" alt="Custom craft 20">
              <div class="photo-caption">Custom craft 20</div>
            </div>
            <div class="photo-item" data-name="Custom craft 21">
              <img src="" alt="Custom craft 21">
              <div class="photo-caption">Custom craft 21</div>
            </div>
          </div>
        </section>
        
        <section class="card hidden" id="items-section" aria-labelledby="items-title" style="margin-top:16px">
          <h2 id="items-title">Custom Items: Morphing Bracelet</h2>
          <p class="muted" style="margin-top:8px">Details and visuals for unique items. (Click to enlarge)</p>
          
          <input id="itemSearch" class="search-input" type="search" placeholder="Search item by name..." aria-label="Search custom item">

          <div class="photo-grid" id="items-grid">
            
            <div class="photo-item" data-name="Morphing Bracelet">
                <img src="https://i.imgur.com/placeholder-item.png" alt="Morphing Bracelet Item">
                <div class="photo-caption">1. Morphing Bracelet</div>
            </div>
            <div class="photo-item" data-name="Morphing Bracelet Recipe">
                <img src="https://i.imgur.com/placeholder-recipe.png" alt="Morphing Bracelet Recipe">
                <div class="photo-caption">2. Crafting Recipe</div>
            </div>
            <div class="photo-item" data-name="Soul Glass Block">
                <img src="https://i.imgur.com/placeholder-glass.png" alt="Soul Glass Block">
                <div class="photo-caption">3. Soul Glass Block</div>
            </div>
            <div class="photo-item" data-name="Soul Sand Repair">
                <img src="https://i.imgur.com/placeholder-repair.png" alt="Soul Sand Repair">
                <div class="photo-caption">4. Repairing (Soul Sand)</div>
            </div>
            
            </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
            <h3 style="margin-top: 0; font-size: 1rem; color: var(--accent);">Morphing Bracelet Details</h3>
            <p style="font-size: 0.9rem; margin: 4px 0;"><strong>Function:</strong> Gives players the ability to morph into different mobs.</p>
            <p style="font-size: 0.9rem; margin: 4px 0;"><strong>Acquisition:</strong> Kill a mob while keeping a **Morphing Bracelet** in your inventory to collect its morph.</p>
            <p style="font-size: 0.9rem; margin: 4px 0;"><strong>Crafting Recipe:</strong> 4x **Soul Soil** + 1x **Soul Glass Block**.</p>
            <p style="font-size: 0.9rem; margin: 4px 0;"><strong>Soul Glass Block:</strong> Smelt **Soul Sand** in a furnace.</p>
            <p style="font-size: 0.9rem; margin: 4px 0;"><strong>Repair:</strong> Hold the bracelet and stand on **Soul Sand** or **Soul Soil** to harness energy and repair its durability.</p>
          </div>

        </section>

      </aside>
    </div>
  </main>

  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card card" style="max-width:420px">
      <h3>Settings</h3>
      <div style="margin-top: 10px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <span style="font-weight: 600;">Theme:</span>
              <button id="themeToggleBtn" class="btn secondary">Light / Dark</button>
          </div>
          <p style="font-weight: 600; margin-bottom: 5px; color: var(--text);">Support Helpline:</p>
          <p style="margin-bottom: 5px;"><a href="tel:9764598332">9764598332</a></p>
          <p><a href="mailto:davidstha900@gmail.com">davidstha900@gmail.com</a></p>
          <a id="discordLink" href="discord://discord.com/channels/1370216217830494230/1370216218392264780" target="_blank" rel="noopener noreferrer" class="discord-btn" style="margin-top:12px">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
              <path d="M13.567 1.888C12.632 1.13 11.455.518 10.158.125A20.284 20.284 0 0 0 7.915 0a20.284 20.284 0 0 0-2.242.125C4.545.518 3.368 1.13 2.433 1.888A11.751 11.751 0 0 0 .546 5.678c.459-.444.975-.823 1.529-1.144a10.28 10.28 0 0 1 1.708-.946A15.751 15.751 0 0 0 7.915 3c2.039 0 4.026.49 5.864 1.488.554.321 1.07.7 1.529 1.144a11.75 11.75 0 0 0-1.887-3.79ZM9.176 9.423c-.78-.714-1.638-1.428-2.583-1.428-.945 0-1.803.714-2.583 1.428A11.77 11.77 0 0 0 2.8 11.835a11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54c-.958-2.417-2.617-3.99-3.854-5.322ZM7.915 14a12.77 12.77 0 0 1-5.115-1.54 11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54A12.77 12.77 0 0 1 7.915 14ZM9.176 9.423c-.78-.714-1.638-1.428-2.583-1.428-.945 0-1.803.714-2.583 1.428A11.77 11.77 0 0 0 2.8 11.835a11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54c-.958-2.417-2.617-3.99-3.854-5.322ZM7.915 14a12.77 12.77 0 0 1-5.115-1.54 11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54A12.77 12.77 0 0 1 7.915 14ZM7.915 12.25c-2.039 0-4.026-.49-5.864-1.488-.554-.321-1.07-.7-1.529-1.144a11.751 11.751 0 0 0 1.887 3.79c.958.749 2.135 1.361 3.432 1.754a20.284 20.284 0 0 0 2.242.125c2.039 0 4.026-.49 5.864-1.488.554-.321 1.07-.7-1.529-1.144a11.751 11.751 0 0 0-1.887-3.79c-.958-.749-2.135-1.361-3.432-1.754a20.284 20.284 0 0 0-2.242-.125Z"/>
            </svg>
            Join Discord VC
          </a>
      </div>
      <div class="actions" style="margin-top:14px">
        <button id="closeSettingsModal" class="btn secondary">Close</button>
      </div>
    </div>
  </div>

  <div id="galleryModal">
    <img id="galleryImg" src="" alt="Full size photo">
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <footer>
    © 2025 King Gamer Nep · Kingamer.aternos.me
  </footer>

  <script>
  (function(){
    'use strict';

    // ---------------- config ----------------
    const MC_HOST = 'Kingamer.aternos.me';
    const MC_PORT = '68586';
    // NOTE: For demo purposes, I'll temporarily use a fixed announcement list 
    // to include the new Morphing Bracelet announcement. 
    // In a real application, you'd update your announcements.json file.
    const ANN_URL = 'https://raw.githubusercontent.com/KingStha0013/server-announcement-/main/announcements.json';
    
    // ⭐ Manual Server Status Toggle ⭐
    const isServerOnline = true; 

    // ---------------- DOM refs ----------------
    const statusDot = document.getElementById('statusDot');
    const serverStateEl = document.getElementById('serverState');
    const onlineContentEl = document.getElementById('onlineContent');
    const announcementsSectionEl = document.getElementById('announcementsSection');

    const playerCountEl = document.getElementById('playerCount');
    const serverMOTDEl = document.getElementById('serverMOTD');

    const annListEl = document.getElementById('annList');
    const annSearchEl = document.getElementById('annSearch');

    const copyIPBtn = document.getElementById('copyIP');
    const joinBtn = document.getElementById('joinMinecraft');
    const openAternosBtn = document.getElementById('openAternos');

    const toggleGalleryBtn = document.getElementById('toggleGalleryBtn');
    const toggleCraftsBtn = document.getElementById('toggleCraftsBtn');
    const toggleWeaponsBtn = document.getElementById('toggleWeaponsBtn');
    const toggleItemsBtn = document.getElementById('toggleItemsBtn');
    
    const photosSection = document.getElementById('photos-section');
    const craftsSection = document.getElementById('crafts-section');
    const weaponsSection = document.getElementById('weapons-section');
    const itemsSection = document.getElementById('items-section');
    
    const photoGrid = document.querySelector('#photos-section .photo-grid');
    const craftsGrid = document.getElementById('crafts-grid');
    const weaponsGrid = document.getElementById('weapons-grid');
    const itemsGrid = document.getElementById('items-grid'); // UPDATED Ref

    
    const armourSearchEl = document.getElementById('armourSearch');
    const weaponSearchEl = document.getElementById('weaponSearch');
    const itemSearchEl = document.getElementById('itemSearch');
    
    const galleryModal = document.getElementById('galleryModal');
    const galleryImg = document.getElementById('galleryImg');
    
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsModalBtn = document.getElementById('closeSettingsModal');
    const themeToggleBtn = document.getElementById('themeToggleBtn');

    const toastEl = document.getElementById('toast');

    // ---------------- state ----------------
    // Custom announcement list to inject the new item announcement at the top
    const customAnnouncements = [
      {
        "title": "NEW ITEM",
        "date": new Date().toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' }),
        "message": "We've added the new Morphing Bracelet! Check out the Custom Items tab for pictures and crafting details.\n\n*Key features:*\n1. Kill any mob with the bracelet in your inventory to **collect its morph**.\n2. **Crafting:** 4 Soul Soil + 1 Soul Glass Block (smelt Soul Sand).\n3. **Repair:** Hold the bracelet and stand on Soul Sand/Soil.",
        // Example of adding an image to an announcement:
        // "image": "https://i.imgur.com/placeholder-item.png" 
      },
      // You would fetch and append the rest of the announcements below this in a real scenario
    ];
    let announcementsCache = [];

    // ---------------- helpers ----------------
    function escapeHtml(s){
      if (s === null || s === undefined) return '';
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function newlineToBreak(s){ return escapeHtml(s).replace(/\r?\n/g, '<br>'); }
    function setStatusDot(online){ if (!statusDot) return; online ? statusDot.classList.add('online') : statusDot.classList.remove('online'); }
    function showToast(text, ms=1400){ if(!toastEl) return; toastEl.textContent = text; toastEl.classList.add('show'); setTimeout(()=> toastEl.classList.remove('show'), ms); }
    
    // ---------------- main logic ----------------
    function updateServerStatus() {
        if (isServerOnline) {
            setStatusDot(true);
            serverStateEl.textContent = 'Online';
            onlineContentEl.style.display = 'block';
            announcementsSectionEl.style.display = 'block';
            
            // Dummy data for online status
            playerCountEl.textContent = '0 / 10';
            serverMOTDEl.textContent = 'Welcome to the Kingamer server! Have fun.';

            fetchAnnouncements();
        } else {
            setStatusDot(false);
            serverStateEl.textContent = 'Server is Offline';
            onlineContentEl.style.display = 'none';
            announcementsSectionEl.style.display = 'none';
        }
    }

    // ---------------- announcements (updated to use custom data) ----------------
    async function fetchAnnouncements(){
      try {
        // Fetch existing announcements
        const res = await fetch(ANN_URL, { cache: 'no-store' });
        const fetchedData = res.ok ? await res.json() : [];
        
        let fetchedList = [];
        if (Array.isArray(fetchedData)) {
            fetchedList = fetchedData;
        } else if (fetchedData && typeof fetchedData === 'object' && Array.isArray(fetchedData.announcements)) {
            fetchedList = fetchedData.announcements;
        } else if (fetchedData && typeof fetchedData === 'object') {
            fetchedList = Object.values(fetchedData);
        }
        
        // Filter and sort fetched list
        fetchedList = fetchedList.filter(item => typeof item === 'object');
        fetchedList.sort((a,b) => {
          const ta = new Date(a.date || a._date || a.timestamp || 0).getTime();
          const tb = new Date(b.date || b._date || b.timestamp || 0).getTime();
          return tb - ta;
        });

        // Combine new custom announcement (at the top) with the fetched list
        const finalAnnouncements = [...customAnnouncements, ...fetchedList];
        announcementsCache = finalAnnouncements;
        renderAnnouncements(finalAnnouncements);
      } catch (err) {
        console.warn('fetchAnnouncements error', err);
        annListEl.innerHTML = '<div class="muted" style="color:#d03">Failed to load announcements. Please check the GitHub URL.</div>';
      }
    }

    function isToday(dateString){
      if (!dateString) return false;
      const d = new Date(dateString);
      if (isNaN(d)) return false;
      const n = new Date();
      return d.getFullYear() === n.getFullYear() && d.getMonth() === n.getMonth() && d.getDate() === n.getDate();
    }

    function renderAnnouncements(list){
      if (!Array.isArray(list) || list.length === 0) { annListEl.innerHTML = '<div class="muted">No announcements available.</div>'; return; }

      annListEl.innerHTML = '';
      list.forEach((item, idx) => {
        const title = escapeHtml(item.title || 'Announcement');
        const date = escapeHtml(item.date || '');
        const message = newlineToBreak(item.message || item.msg || item.body || '');
        const image = item.image ? `<img src="${escapeHtml(item.image)}" alt="${title} image" />` : ''; // Handle optional image
        const isNew = idx === 0;
        const highlight = isToday(item.date) ? 'highlight-today' : '';

        const wrapper = document.createElement('div');
        wrapper.className = 'ann-item ' + highlight;
        wrapper.innerHTML = `
          <div class="ann-head" role="button" tabindex="0" aria-expanded="false">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="ann-title">${title}</div>
              ${isNew ? '<div class="badge-new" aria-hidden="true">NEW</div>' : ''}
            </div>
            <div style="display:flex;align-items:center;gap:12px">
              <div class="ann-date">${date}</div>
              <div class="muted" style="font-size:0.92rem"> <span class="arrow">▸</span> </div>
            </div>
          </div>
          <div class="ann-body" aria-hidden="true"><div style="font-size:0.95rem;color:#222">${message}${image}</div></div>
        `;
        annListEl.appendChild(wrapper);
      });

      // attach toggle handlers
      annListEl.querySelectorAll('.ann-head').forEach(head => {
        head.addEventListener('click', () => toggleAnn(head));
        head.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleAnn(head); } });
      });
    }

    function toggleAnn(head){
      const parent = head.parentElement;
      const body = parent.querySelector('.ann-body');
      const isOpen = parent.classList.toggle('open');
      parent.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      body.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
    }

    let searchTimeout = null;
    annSearchEl.addEventListener('input', e => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const q = String(e.target.value || '').trim().toLowerCase();
        if (!q) { renderAnnouncements(announcementsCache); return; }
        const filtered = announcementsCache.filter(it => {
          const title = (it.title || '').toString().toLowerCase();
          const msg = (it.message || it.msg || it.body || '').toString().toLowerCase();
          const date = (it.date || '').toString().toLowerCase();
          return title.includes(q) || msg.includes(q) || date.includes(q);
        });
        renderAnnouncements(filtered);
      }, 200);
    });

    // ---------------- SEARCH FILTERS ----------------
    function setupFilter(searchEl, containerEl) {
        if (searchEl && containerEl) {
            searchEl.addEventListener('input', () => {
                const query = String(searchEl.value || '').trim().toLowerCase();
                // Select items based on the photo-item class
                const items = containerEl.querySelectorAll('.photo-item');

                items.forEach(item => {
                    const name = item.getAttribute('data-name');
                    const isMatch = name && name.toLowerCase().includes(query);
                    
                    item.style.display = isMatch ? 'flex' : 'none'; // Photo items are display: flex
                });
            });
        }
    }
    setupFilter(armourSearchEl, craftsGrid);
    setupFilter(weaponSearchEl, weaponsGrid);
    setupFilter(itemSearchEl, itemsGrid); // Applying filter to the new items grid

    // ---------------- copy IP / quick actions ----------------
    async function copyIP(){
      const txt = MC_HOST + ':' + MC_PORT;
      try {
        await navigator.clipboard.writeText(txt);
        showToast('Server IP copied');
      } catch {
        alert('Copy this: ' + txt);
      }
    }

    function openAternosPanel(){ window.open('https://aternos.org', '_blank'); }
    function openMinecraftUri(){
      const uri = `minecraft://?addExternalServer=Kingamer|${MC_HOST}:${MC_PORT}`;
      window.location.href = uri;
      setTimeout(()=> showToast('If Minecraft did not open, IP was copied'), 700);
    }
    
    // ⭐ REFACTORED TOGGLE FUNCTION (Updated for 4 sections) ⭐
    function toggleSection(sectionToShow, buttonTextToShow, storageKey) {
        const isHidden = sectionToShow.classList.contains('hidden');
        // Include the new itemsSection
        const sections = [photosSection, craftsSection, weaponsSection, itemsSection]; 

        sections.forEach(sec => {
            const secName = sec.id.split('-')[0];
            const button = document.getElementById(`toggle${secName.charAt(0).toUpperCase() + secName.slice(1)}Btn`);

            // Determine default button text for other sections
            let defaultText = '';
            if (sec === photosSection) defaultText = 'Photos';
            else if (sec === craftsSection) defaultText = 'Custom Armour';
            else if (sec === weaponsSection) defaultText = 'Custom Weapon';
            else if (sec === itemsSection) defaultText = 'Custom Items';

            if (sec === sectionToShow) {
                if (isHidden) {
                    sec.classList.remove('hidden');
                    button.textContent = `Hide ${buttonTextToShow}`;
                    localStorage.setItem(storageKey, 'true');
                    
                    setTimeout(() => {
                        sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 10);
                } else {
                    sec.classList.add('hidden');
                    button.textContent = defaultText; 
                    localStorage.setItem(storageKey, 'false');
                }
            } else {
                // Hide other sections
                sec.classList.add('hidden');
                if (button) {
                    button.textContent = defaultText;
                }
                // Update storage for other sections
                const otherKey = `show${secName.charAt(0).toUpperCase() + secName.slice(1)}`;
                localStorage.setItem(otherKey, 'false');
            }
        });
    }

    // --- Section Button Event Listeners & Initialization ---

    // Map buttons to their sections and default text (Updated for 4 sections)
    const toggleMap = [
        { btn: toggleGalleryBtn, section: photosSection, text: 'Photos', key: 'showPhotos' },
        { btn: toggleCraftsBtn, section: craftsSection, text: 'Custom Armour', key: 'showCrafts' },
        { btn: toggleWeaponsBtn, section: weaponsSection, text: 'Custom Weapon', key: 'showWeapons' },
        { btn: toggleItemsBtn, section: itemsSection, text: 'Custom Items', key: 'showItems' }
    ];

    toggleMap.forEach(item => {
        if (item.btn && item.section) {
            // Initialization (Restore state from localStorage)
            const isShown = localStorage.getItem(item.key) === 'true';
            if (isShown) {
                item.section.classList.remove('hidden');
                item.btn.textContent = `Hide ${item.text}`;
            } else {
                item.section.classList.add('hidden');
                item.btn.textContent = item.text;
            }

            // Click Handler
            item.btn.addEventListener('click', () => {
                toggleSection(item.section, item.text, item.key);
            });
        }
    });

    // Photo Gallery Modal Logic
    const allGrids = [photoGrid, craftsGrid, weaponsGrid, itemsGrid]; // UPDATED to include itemsGrid
    
    allGrids.forEach(grid => {
        if (grid && galleryModal && galleryImg) {
            grid.addEventListener('click', (event) => {
                // Check if the click was directly on an image, or inside a photo-item
                const item = event.target.closest('.photo-item');
                const img = event.target.tagName === 'IMG' ? event.target : item ? item.querySelector('img') : null;
                
                if (img && img.src && img.src.length > 0) {
                    galleryImg.src = img.src;
                    galleryModal.style.display = 'flex';
                }
            });
        }
    });

    // Global modal close listeners
    if (galleryModal) {
      galleryModal.addEventListener('click', () => {
        galleryModal.style.display = 'none';
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          galleryModal.style.display = 'none';
        }
      });
    }
    
    // ---------------- modals ----------------
    function openModal(modal){ modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false'); }
    function closeModal(modal){ modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); }

    // Settings Modal
    settingsBtn.addEventListener('click', () => openModal(settingsModal));
    closeSettingsModalBtn.addEventListener('click', () => closeModal(settingsModal));
    settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) closeModal(settingsModal); });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal(settingsModal);
        }
    });

    // ---------------- Theme Toggle ----------------
    themeToggleBtn.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark-mode');
    });

    // ---------------- wire events ----------------
    copyIPBtn.addEventListener('click', copyIP);
    joinBtn.addEventListener('click', openMinecraftUri);
    openAternosBtn.addEventListener('click', openAternosPanel);
    
    // ---------------- start ----------------
    updateServerStatus();

  })();
  </script>
</body>
</html>


<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kingamer Server — v.9</title>

  <style>
    :root{
      --bg: #f6f7f9;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #0b5ed7;
      --success: #198754;
      --danger: #dc3545;
      --radius: 10px;
      --maxwidth: 980px;
      --gap: 16px;
      --mono: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Dark theme */
    .dark-mode:root{
      --bg: #1f2937;
      --card: #374151;
      --text: #f9fafb;
      --muted: #d1d5db;
      --accent: #60a5fa;
      --success: #34d399;
      --danger: #f87171;
    }
    .dark-mode .ann-head{ background: #374151; }
    .dark-mode .ann-item{ border-color: rgba(249, 250, 251, 0.05); }
    .dark-mode .ann-body{ border-top-color: rgba(249, 250, 251, 0.04); color: var(--muted); }
    .dark-mode .highlight-today{ background: linear-gradient(180deg, #374151, #3f4a5b); }
    .dark-mode header{ background: #374151; box-shadow: 0 2px 6px rgba(0,0,0,0.2); border-bottom: 1px solid rgba(249, 250, 251, 0.02);}
    .dark-mode .toast{ background: rgba(255,255,255,0.95); color: #333; }
    
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:var(--mono);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    button{font-family:inherit;cursor:pointer}

    /* header */
    header{background:var(--card);padding:18px 16px;box-shadow:0 2px 6px rgba(16,24,40,0.06);border-bottom:1px solid rgba(16,24,40,0.02);position:sticky;top:0;z-index:40}
    .header-inner{max-width:var(--maxwidth);margin:0 auto;display:flex;gap:12px;align-items:center;justify-content:center;position:relative}
    .flag{width:28px;height:auto}
    h1{font-size:1.45rem;margin:0;letter-spacing:0.2px;font-weight:700}
    #settingsBtn{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:none;background:transparent;width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:1.4rem;transition:background .2s, color .2s}
    #settingsBtn:hover{background:rgba(16,24,40,0.04);color:var(--text)}

    /* action row */
    .button-row{max-width:var(--maxwidth);margin:12px auto;padding:8px 12px;display:flex;gap:8px;justify-content:center;align-items:center;flex-wrap: wrap;}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:6px;border:none;font-weight:600;color:white;background:var(--accent);transition:transform .12s,box-shadow .12s;font-size: 0.9rem;}
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(11,94,215,0.12);font-weight:600}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(16,24,40,0.06);font-weight:600;font-size: 0.85rem;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(11,94,215,0.08)}
    
    /* layout */
    main.container{max-width:var(--maxwidth);margin:18px auto;padding:0 14px 48px}
    .grid{display:grid;gap:var(--gap);grid-template-columns:1fr}
    @media(min-width:980px){.grid{grid-template-columns:1fr 360px}}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06);border:1px solid rgba(16,24,40,0.03)}
    .card h2{margin:0 0 8px 0;font-size:1.05rem;color:var(--text)}
    .muted{color:var(--muted);font-size:0.92rem}
    .flex{display:flex;gap:8px;align-items:center}
    .spacer{flex:1}

    /* server card */
    .server-top{display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .server-left{display:flex;gap:12px;align-items:center}
    .status-dot{width:12px;height:12px;border-radius:50%;background:var(--danger);box-shadow:0 6px 18px rgba(220,53,69,0.06)}
    .status-dot.online{background:var(--success);box-shadow:0 8px 22px rgba(25,135,84,0.06)}
    .server-meta{font-weight:700;font-size:0.98rem}
    .server-sub{color:var(--muted);font-size:0.92rem;margin-top:4px}
    .players{font-family:var(--mono);font-weight:800;color:var(--accent);margin-top:10px;font-size:1.1rem}
    .server-actions{margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap: wrap;}
    .ghost{background:transparent;border:1px solid rgba(16,24,40,0.06);padding:8px 10px;border-radius:6px; font-size: 0.85rem;}

    /* announcements */
    .ann-controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .search-input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(16,24,40,0.06)}
    .ann-list{display:flex;flex-direction:column;gap:10px;max-height:520px;overflow:auto;padding-right:6px}
    .ann-item{border:1px solid rgba(16,24,40,0.04);border-radius:8px;overflow:hidden;background:var(--card)}
    .ann-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#f8fafc;cursor:pointer}
    .ann-title{font-weight:700}
    .ann-date{color:var(--muted);font-size:0.88rem;margin-right:12px}
    .ann-body{padding:12px 14px;border-top:1px solid rgba(16,24,40,0.03);display:none;color:#222}
    .ann-item.open .ann-body{display:block}
    .badge-new{background:var(--accent);color:white;padding:4px 8px;border-radius:999px;font-weight:700;font-size:0.78rem}
    .highlight-today{background:linear-gradient(180deg,#fff9eb,#ffffff)}
    .arrow{transition:transform .22s ease;display:inline-block;margin-left:6px}
    .ann-item.open .arrow{transform:rotate(90deg)}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(16,24,40,0.45);z-index:100}
    .modal .modal-card{width:92%;max-width:420px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.18)}
    .modal h3{margin:0 0 8px 0}
    .modal p{color:var(--muted);margin:0}
    .modal .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:14px}
    
    /* toast */
    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:rgba(20,20,20,0.95);color:white;padding:10px 14px;border-radius:8px;font-weight:600;box-shadow:0 10px 30px rgba(0,0,0,0.35);opacity:0;pointer-events:none;transition:opacity .18s ease,transform .18s ease;z-index:200}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:auto}

    /* footer */
    footer{text-align:center;color:var(--muted);padding:30px 0 40px;font-size:0.95rem}

    .discord-btn {
        background: #5865f2;
        color: white;
        font-weight: 700;
        padding: 10px 12px;
        border-radius: 6px;
        display: block;
        text-align: center;
        margin-top: 10px;
        transition: transform .2s ease;
    }
    .discord-btn:hover {
        transform: translateY(-2px);
    }
    .discord-btn svg {
        margin-right: 8px;
    }

    @media (max-width:520px){
      .ann-controls{flex-direction:column;align-items:stretch;gap:8px}
      .button-row{flex-wrap:wrap;gap:8px}
    }
  </style>
</head>
<body>

  <header>
    <div class="header-inner" role="banner">
      <img class="flag" src="https://flagcdn.com/w20/np.png" alt="Nepal flag">
      <h1>Kingamer Server</h1>
      <button id="settingsBtn" title="Settings" aria-label="Settings">⚙️</button>
    </div>
  </header>

  <div class="button-row" role="navigation" aria-label="Primary actions">
    <a class="btn" id="linkAternos" href="https://aternos.org" target="_blank" rel="noopener noreferrer">Aternos</a>
    <a class="btn" href="https://chunkbase.com/" target="_blank" rel="noopener noreferrer">Chunkbase</a>
    <button id="btnMCPack" class="btn secondary" title="MCPack (coming soon)">MCPack</button>
    <a class="btn secondary" id="linkReport" href="mailto:davidstha900@gmail.com?subject=Kingamer%20Server%20Report&body=Please%20describe%20the%20issue%20or%20feedback%20here.">Report</a>
  </div>

  <main class="container" role="main">
    <div class="grid">

      <div>

        <section class="card" aria-labelledby="server-title">
          <h2 id="server-title">Server Info</h2>

          <div class="server-top">
            <div class="server-left" role="status" aria-live="polite">
              <div id="statusDot" class="status-dot" aria-hidden="true"></div>
              <div>
                <div id="serverState" class="server-meta">Checking server status…</div>
                <div id="serverDetails" class="server-sub">IP: <span id="serverAddr">Kingamer.aternos.me</span> · Port: <span id="serverPort">68586</span></div>
              </div>
            </div>

            <div class="spacer" aria-hidden="true"></div>

          </div>

          <div id="onlineContent" style="display: none;">
            <div class="players" id="playerCount">—</div>
            <div id="serverMOTD" class="server-sub" style="margin-top:8px"></div>

            <div class="server-actions" role="group" aria-label="Server actions">
              <button id="copyIP" class="btn ghost" title="Copy IP">Copy IP</button>
              <button id="joinMinecraft" class="btn ghost" title="Join in Minecraft">Join in Minecraft</button>
              <button id="openAternos" class="btn ghost" title="Open Aternos">Open Aternos</button>
            </div>
          </div>
        </section>

        <section class="card" id="announcementsSection" aria-labelledby="ann-title" style="margin-top:16px; display: none;">
          <h2 id="ann-title">Announcements</h2>

          <div class="ann-controls" style="margin-top:8px">
            <input id="annSearch" class="search-input" type="search" placeholder="Search announcements..." aria-label="Search announcements">
            <div class="spacer" aria-hidden="true"></div>
          </div>

          <div class="ann-list" id="annList" aria-live="polite">
            <div class="muted">Loading announcements…</div>
          </div>
        </section>

      </div>

      <aside>
        <div class="card" aria-labelledby="info-title">
          <h2 id="info-title">Info</h2>
          <p class="muted" style="margin-top:8px">Server info and announcements are updated on page load. Latest announcement is marked <strong>NEW</strong>. Today's announcements highlighted.</p>
        </div>
      </aside>
    </div>
  </main>

  <div id="mcModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card card" style="max-width:420px">
      <h3>MCPack</h3>
      <p class="muted" style="margin-top:8px">This feature will be available soon. A download link will appear here when the MCPack is ready.</p>
      <div class="actions" style="margin-top:14px">
        <button id="closeModal" class="btn secondary">Close</button>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card card" style="max-width:420px">
      <h3>Settings</h3>
      <div style="margin-top: 10px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <span style="font-weight: 600;">Theme:</span>
              <button id="themeToggleBtn" class="btn secondary">Light / Dark</button>
          </div>
          <p style="font-weight: 600; margin-bottom: 5px; color: var(--text);">Support Helpline:</p>
          <p style="margin-bottom: 5px;"><a href="tel:9764598332">9764598332</a></p>
          <p><a href="mailto:davidstha900@gmail.com">davidstha900@gmail.com</a></p>
          <a href="https://discord.gg" target="_blank" class="discord-btn" style="margin-top:12px">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
              <path d="M13.567 1.888C12.632 1.13 11.455.518 10.158.125A20.284 20.284 0 0 0 7.915 0a20.284 20.284 0 0 0-2.242.125C4.545.518 3.368 1.13 2.433 1.888A11.751 11.751 0 0 0 .546 5.678c.459-.444.975-.823 1.529-1.144a10.28 10.28 0 0 1 1.708-.946A15.751 15.751 0 0 0 7.915 3c2.039 0 4.026.49 5.864 1.488.554.321 1.07.7 1.529 1.144a11.75 11.75 0 0 0-1.887-3.79ZM9.176 9.423c-.78-.714-1.638-1.428-2.583-1.428-.945 0-1.803.714-2.583 1.428A11.77 11.77 0 0 0 2.8 11.835a11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54c-.958-2.417-2.617-3.99-3.854-5.322ZM7.915 14a12.77 12.77 0 0 1-5.115-1.54 11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54A12.77 12.77 0 0 1 7.915 14ZM9.176 9.423c-.78-.714-1.638-1.428-2.583-1.428-.945 0-1.803.714-2.583 1.428A11.77 11.77 0 0 0 2.8 11.835a11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54c-.958-2.417-2.617-3.99-3.854-5.322ZM7.915 14a12.77 12.77 0 0 1-5.115-1.54 11.77 11.77 0 0 0 5.115 1.54 11.77 11.77 0 0 0 5.115-1.54A12.77 12.77 0 0 1 7.915 14ZM7.915 12.25c-2.039 0-4.026-.49-5.864-1.488-.554-.321-1.07-.7-1.529-1.144a11.751 11.751 0 0 0 1.887 3.79c.958.749 2.135 1.361 3.432 1.754a20.284 20.284 0 0 0 2.242.125c2.039 0 4.026-.49 5.864-1.488.554-.321 1.07-.7 1.529-1.144a11.751 11.751 0 0 0-1.887-3.79c-.958-.749-2.135-1.361-3.432-1.754a20.284 20.284 0 0 0-2.242-.125Z"/>
            </svg>
            Join Discord VC
          </a>
      </div>
      <div class="actions" style="margin-top:14px">
        <button id="closeSettingsModal" class="btn secondary">Close</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <footer>
    © 2025 King Gamer Nep · Kingamer.aternos.me
  </footer>

  <script>
  (function(){
    'use strict';

    // ---------------- config ----------------
    const MC_HOST = 'Kingamer.aternos.me';
    const MC_PORT = '68586';
    const ANN_URL = 'https://raw.githubusercontent.com/KingStha0013/server-announcement-/main/announcements.json';
    
    // ⭐ Manual Server Status Toggle ⭐
    const isServerOnline = true; // CHANGE THIS TO `false` TO SIMULATE OFFLINE STATUS

    // ---------------- DOM refs ----------------
    const statusDot = document.getElementById('statusDot');
    const serverStateEl = document.getElementById('serverState');
    const onlineContentEl = document.getElementById('onlineContent');
    const announcementsSectionEl = document.getElementById('announcementsSection');

    const playerCountEl = document.getElementById('playerCount');
    const serverMOTDEl = document.getElementById('serverMOTD');

    const annListEl = document.getElementById('annList');
    const annSearchEl = document.getElementById('annSearch');

    const copyIPBtn = document.getElementById('copyIP');
    const joinBtn = document.getElementById('joinMinecraft');
    const openAternosBtn = document.getElementById('openAternos');

    const btnMCPack = document.getElementById('btnMCPack');
    const mcModal = document.getElementById('mcModal');
    const closeModalBtn = document.getElementById('closeModal');
    
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsModalBtn = document.getElementById('closeSettingsModal');
    const themeToggleBtn = document.getElementById('themeToggleBtn');

    const toastEl = document.getElementById('toast');

    // ---------------- state ----------------
    let announcementsCache = [];

    // ---------------- helpers ----------------
    function escapeHtml(s){
      if (s === null || s === undefined) return '';
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function newlineToBreak(s){ return escapeHtml(s).replace(/\r?\n/g, '<br>'); }
    function setStatusDot(online){ if (!statusDot) return; online ? statusDot.classList.add('online') : statusDot.classList.remove('online'); }
    function showToast(text, ms=1400){ if(!toastEl) return; toastEl.textContent = text; toastEl.classList.add('show'); setTimeout(()=> toastEl.classList.remove('show'), ms); }
    
    // ---------------- main logic ----------------
    function updateServerStatus() {
        if (isServerOnline) {
            setStatusDot(true);
            serverStateEl.textContent = 'Online';
            onlineContentEl.style.display = 'block';
            announcementsSectionEl.style.display = 'block';
            
            // Dummy data for online status
            playerCountEl.textContent = '0 / 10';
            serverMOTDEl.textContent = 'Welcome to the Kingamer server! Have fun.';

            fetchAnnouncements();
        } else {
            setStatusDot(false);
            serverStateEl.textContent = 'Server is Offline';
            onlineContentEl.style.display = 'none';
            announcementsSectionEl.style.display = 'none';
        }
    }

    // ---------------- announcements ----------------
    async function fetchAnnouncements(){
      try {
        annListEl.innerHTML = '<div class="muted">Loading announcements…</div>';
        const res = await fetch(ANN_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('Announcements fetch ' + res.status);
        const data = await res.json();

        let list = [];
        if (Array.isArray(data)) list = data;
        else if (data.announcements && Array.isArray(data.announcements)) list = data.announcements;
        else if (typeof data === 'object') list = Object.values(data);

        // sort newest-first securely
        list.sort((a,b) => {
          const ta = new Date(a.date || a._date || a.timestamp || 0).getTime();
          const tb = new Date(b.date || b._date || b.timestamp || 0).getTime();
          return tb - ta;
        });

        announcementsCache = list;
        renderAnnouncements(list);
      } catch (err) {
        console.warn('fetchAnnouncements error', err);
        annListEl.innerHTML = '<div class="muted" style="color:#d03">Failed to load announcements.</div>';
      }
    }

    function isToday(dateString){
      if (!dateString) return false;
      const d = new Date(dateString);
      if (isNaN(d)) return false;
      const n = new Date();
      return d.getFullYear() === n.getFullYear() && d.getMonth() === n.getMonth() && d.getDate() === n.getDate();
    }

    function renderAnnouncements(list){
      if (!Array.isArray(list) || list.length === 0) { annListEl.innerHTML = '<div class="muted">No announcements available.</div>'; return; }

      annListEl.innerHTML = '';
      list.forEach((item, idx) => {
        const title = escapeHtml(item.title || 'Announcement');
        const date = escapeHtml(item.date || '');
        const message = newlineToBreak(item.message || item.msg || item.body || '');
        const isNew = idx === 0;
        const highlight = isToday(item.date) ? 'highlight-today' : '';

        const wrapper = document.createElement('div');
        wrapper.className = 'ann-item ' + highlight;
        wrapper.innerHTML = `
          <div class="ann-head" role="button" tabindex="0" aria-expanded="false">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="ann-title">${title}</div>
              ${isNew ? '<div class="badge-new" aria-hidden="true">NEW</div>' : ''}
            </div>
            <div style="display:flex;align-items:center;gap:12px">
              <div class="ann-date">${date}</div>
              <div class="muted" style="font-size:0.92rem"> <span class="arrow">▸</span> </div>
            </div>
          </div>
          <div class="ann-body" aria-hidden="true"><div style="font-size:0.95rem;color:#222">${message}</div></div>
        `;
        annListEl.appendChild(wrapper);
      });

      // attach toggle handlers
      annListEl.querySelectorAll('.ann-head').forEach(head => {
        head.addEventListener('click', () => toggleAnn(head));
        head.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleAnn(head); } });
      });
    }

    function toggleAnn(head){
      const parent = head.parentElement;
      const body = parent.querySelector('.ann-body');
      const isOpen = parent.classList.toggle('open');
      parent.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      body.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
    }

    // search (debounced)
    let searchTimeout = null;
    annSearchEl.addEventListener('input', e => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const q = String(e.target.value || '').trim().toLowerCase();
        if (!q) { renderAnnouncements(announcementsCache); return; }
        const filtered = announcementsCache.filter(it => {
          const title = (it.title || '').toString().toLowerCase();
          const msg = (it.message || it.msg || it.body || '').toString().toLowerCase();
          const date = (it.date || '').toString().toLowerCase();
          return title.includes(q) || msg.includes(q) || date.includes(q);
        });
        renderAnnouncements(filtered);
      }, 200);
    });

    // ---------------- copy IP ----------------
    async function copyIP(){
      const txt = MC_HOST + ':' + MC_PORT;
      try {
        await navigator.clipboard.writeText(txt);
        showToast('Server IP copied');
      } catch {
        alert('Copy this: ' + txt);
      }
    }

    // ---------------- quick actions ----------------
    function openAternosPanel(){ window.open('https://aternos.org', '_blank'); }
    function openMinecraftUri(){
      const uri = `minecraft://?addExternalServer=Kingamer|${MC_HOST}:${MC_PORT}`;
      window.location.href = uri;
      setTimeout(()=> showToast('If Minecraft did not open, IP was copied'), 700);
    }

    // ---------------- modals ----------------
    function openModal(modal){ modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false'); }
    function closeModal(modal){ modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); }

    // MCPack Modal
    btnMCPack.addEventListener('click', () => openModal(mcModal));
    closeModalBtn.addEventListener('click', () => closeModal(mcModal));
    mcModal.addEventListener('click', (e) => { if (e.target === mcModal) closeModal(mcModal); });

    // Settings Modal
    settingsBtn.addEventListener('click', () => openModal(settingsModal));
    closeSettingsModalBtn.addEventListener('click', () => closeModal(settingsModal));
    settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) closeModal(settingsModal); });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal(mcModal);
            closeModal(settingsModal);
        }
    });

    // ---------------- Theme Toggle ----------------
    themeToggleBtn.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark-mode');
    });

    // ---------------- wire events ----------------
    copyIPBtn.addEventListener('click', copyIP);
    joinBtn.addEventListener('click', openMinecraftUri);
    openAternosBtn.addEventListener('click', openAternosPanel);
    
    // ---------------- start ----------------
    updateServerStatus();

  })();
  </script>
</body>
</html>
